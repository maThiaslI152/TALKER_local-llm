



local language = require("infra.language")


function on_mcm_load()
    options = {
        id = "talker",
        sh = true,
        gr = {
            -- Local LLM Configuration
            {
                id = "local_settings_title",
                type = "desc",
                clr = {200, 200, 255, 200},
                text = "ui_mcm_talker_local_settings_title"
            },
            



            {
                id = "local_url",
                type = "input",
                val = "http://localhost:11434/api/chat",
                def = "http://localhost:11434/api/chat",
            },
            {
                id = "local_model_name",
                type = "input",
                val = "llama3.2",
                def = "llama3.2",
            },
            {
                id = "desc_model_smart",
                type = "desc",
                text = "ui_mcm_talker_model_smart_desc" 
            },
            
            -- FAST MODEL TOGGLE
            {
                id = "use_fast_model",
                type = "check",
                val = 1,
                def = 0,
            },
            {
                id = "desc_use_fast_model",
                type = "desc",
                text = "ui_mcm_talker_use_fast_model_desc" 
            },

            -- FAST MODEL SETTINGS
            {
                id = "local_url_fast",
                type = "input",
                val = "http://localhost:11434/api/chat",
                def = "http://localhost:11434/api/chat",
            },
            {
                id = "local_model_name_fast",
                type = "input",
                val = "llama3.2:1b",
                def = "llama3.2:1b",
            },
            {
                id = "desc_model_fast",
                type = "desc",
                text = "ui_mcm_talker_model_fast_desc" 
            },

            -- Language Selection
            {
                id = "language",
                type = "radio_h",
                val = language.any.long,
                def = language.any.long,
                content = {
                    { language.any.long, language.any.long },
                    { language.en.long, language.en.long },
                    { language.uk.long, language.uk.long },
                    { language.ru.long, language.ru.long },
                },
                name = "ui_mcm_talker_language"
            },
            
            -- Dialogue Frequency
            {
                id = "base_chance",
                type = "track",
                val = 2,
                min = 0.0,
                max = 1.0,
                step = 0.05,
                def = 0.25,
            },
            {
                id = "desc_base_chance",
                type = "desc",
                text = "ui_mcm_talker_base_chance_desc" 
            },
            
            -- Context Profile
            {
                id = "context_profile",
                type = "list",
                val = 2,
                def = "medium",
                content = {
                    { "low", "ui_mcm_talker_profile_low" },
                    { "medium", "ui_mcm_talker_profile_medium" },
                    { "high", "ui_mcm_talker_profile_high" }
                }
            },
            {
                id = "desc_context_profile",
                type = "desc",
                text = "ui_mcm_talker_context_profile_desc" 
            },

            -- Clear Memory
            {
                id = "clear_memory_on_load",
                type = "check",
                val = 1,
                def = false
            },
            {
                id = "desc_clear_memory",
                type = "desc",
                text = "ui_mcm_talker_clear_memory_desc" 
            },
            
            -- Chat Key UI
            {
                id = "chat_key_title",
                type = "desc",
                clr = {200, 200, 255, 200},
                text = "ui_mcm_talker_chat_key_title"
            },
            {
                id = "chat_key_description",
                type = "desc",
                text = "ui_mcm_talker_chat_key_description"
            },
            {
                id = "speak_key", -- Keep ID as speak_key for config compatibility
                type = "key_bind",
                val = 2,
                def = DIK_keys.DIK_LMENU,
                text = "ui_mcm_talker_chat_key" -- But change label
            },

            -- Debug Mode
            {
                id = "debug_enabled",
                type = "check",
                val = 1,
                def = false
            }
        }
    }
    return options
end

-- Default configuration values
local defaults = {
    ["speak_key"] = DIK_keys.DIK_LMENU,
    ["local_url"] = "http://localhost:11434/api/chat",
    ["local_model_name"] = "llama3.2",
    ["use_fast_model"] = false,
    ["local_url_fast"] = "http://localhost:11434/api/chat",
    ["local_model_name_fast"] = "llama3.2:1b",
    ["language"] = language.any.long,
    ["base_chance"] = 0.25,
    ["context_profile"] = "medium",
    ["clear_memory_on_load"] = false,
    ["debug_enabled"] = false,
}

-- Function to retrieve the configuration value
function get(key)
    if ui_mcm then
        return ui_mcm.get("talker/" .. key)
    else
        return defaults[key]
    end
end
